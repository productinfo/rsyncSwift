<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Librsync: /Users/Zheng/Desktop/librsync-0.9.7/rdiff.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Librsync
   &#160;<span id="projectnumber">0.9.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_e0a0668ff26f806d9b0a7a57c19c20ed.html">librsync-0.9.7</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">rdiff.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="config_8h_source.html">config.h</a>&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;<a class="el" href="popt_8h_source.html">popt.h</a>&gt;</code><br />
<code>#include &lt;zlib.h&gt;</code><br />
<code>#include &lt;bzlib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="librsync_8h_source.html">librsync.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fileutil_8h_source.html">fileutil.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util_8h_source.html">util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="isprefix_8h_source.html">isprefix.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="snprintf_8h_source.html">snprintf.h</a>&quot;</code><br />
</div>
<p><a href="rdiff_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a906afbfd1ce81a146b72d1ce928e7abb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdiff_8c.html#a906afbfd1ce81a146b72d1ce928e7abb">PROGRAM</a>&#160;&#160;&#160;&quot;rdiff&quot;</td></tr>
<tr class="separator:a906afbfd1ce81a146b72d1ce928e7abb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a1c677eb4324cc0e17007a0d81c337420">OPT_GZIP</a> = 1069, 
<a class="el" href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae364cc42337e882efe36076e260e422d">OPT_BZIP2</a>
 }<tr class="separator:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad53223b8779f25caeddb70a3b9172967"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdiff_8c.html#ad53223b8779f25caeddb70a3b9172967">main</a> (const int argc, const char *argv[])</td></tr>
<tr class="separator:ad53223b8779f25caeddb70a3b9172967"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9ae205d5a1d8a22f7369d19d57caa3c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdiff_8c.html#a9ae205d5a1d8a22f7369d19d57caa3c2">rs_roll_paranoia</a></td></tr>
<tr class="separator:a9ae205d5a1d8a22f7369d19d57caa3c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3087600ee8cab9da450e9a7d893b5970"><td class="memItemLeft" align="right" valign="top">const struct <a class="el" href="structpopt_option.html">poptOption</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdiff_8c.html#a3087600ee8cab9da450e9a7d893b5970">opts</a> []</td></tr>
<tr class="separator:a3087600ee8cab9da450e9a7d893b5970"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a906afbfd1ce81a146b72d1ce928e7abb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROGRAM&#160;&#160;&#160;&quot;rdiff&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rdiff_8c_source.html#l00072">72</a> of file <a class="el" href="rdiff_8c_source.html">rdiff.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="adf764cbdea00d65edcd07bb9953ad2b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="adf764cbdea00d65edcd07bb9953ad2b7a1c677eb4324cc0e17007a0d81c337420"></a>OPT_GZIP&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="adf764cbdea00d65edcd07bb9953ad2b7ae364cc42337e882efe36076e260e422d"></a>OPT_BZIP2&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="rdiff_8c_source.html#l00083">83</a> of file <a class="el" href="rdiff_8c_source.html">rdiff.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ad53223b8779f25caeddb70a3b9172967"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rdiff_8c_source.html#l00367">367</a> of file <a class="el" href="rdiff_8c_source.html">rdiff.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a3087600ee8cab9da450e9a7d893b5970"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="structpopt_option.html">poptOption</a> opts[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    { <span class="stringliteral">&quot;verbose&quot;</span>,     <span class="charliteral">&#39;v&#39;</span>, <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <span class="charliteral">&#39;v&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;version&quot;</span>,     <span class="charliteral">&#39;V&#39;</span>, <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <span class="charliteral">&#39;V&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;input-size&quot;</span>,  <span class="charliteral">&#39;I&#39;</span>, <a class="code" href="popt_8h.html#a6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a>,  &amp;<a class="code" href="buf_8c.html#a13d30eb003d6b9d3311435279879dd32">rs_inbuflen</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;output-size&quot;</span>, <span class="charliteral">&#39;O&#39;</span>, <a class="code" href="popt_8h.html#a6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a>,  &amp;<a class="code" href="buf_8c.html#ade12a7fac722a79cf4c396cd2f7db6ff">rs_outbuflen</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;help&quot;</span>,        <span class="charliteral">&#39;?&#39;</span>, <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <span class="charliteral">&#39;h&#39;</span> },</div>
<div class="line">    {  0,            <span class="charliteral">&#39;h&#39;</span>, <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <span class="charliteral">&#39;h&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;block-size&quot;</span>,  <span class="charliteral">&#39;b&#39;</span>, <a class="code" href="popt_8h.html#a6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a>,  &amp;block_len },</div>
<div class="line">    { <span class="stringliteral">&quot;sum-size&quot;</span>,    <span class="charliteral">&#39;S&#39;</span>, <a class="code" href="popt_8h.html#a6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a>,  &amp;strong_len },</div>
<div class="line">    { <span class="stringliteral">&quot;statistics&quot;</span>,  <span class="charliteral">&#39;s&#39;</span>, <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, &amp;show_stats },</div>
<div class="line">    { <span class="stringliteral">&quot;stats&quot;</span>,        0,  <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, &amp;show_stats },</div>
<div class="line">    { <span class="stringliteral">&quot;gzip&quot;</span>,         0,  <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <a class="code" href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a1c677eb4324cc0e17007a0d81c337420">OPT_GZIP</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;bzip2&quot;</span>,        0,  <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, 0,             <a class="code" href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae364cc42337e882efe36076e260e422d">OPT_BZIP2</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;paranoia&quot;</span>,     0,  <a class="code" href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>, &amp;<a class="code" href="rdiff_8c.html#a9ae205d5a1d8a22f7369d19d57caa3c2">rs_roll_paranoia</a> },</div>
<div class="line">    { 0 }</div>
<div class="line">}</div>
<div class="ttc" id="rdiff_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a1c677eb4324cc0e17007a0d81c337420"><div class="ttname"><a href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a1c677eb4324cc0e17007a0d81c337420">OPT_GZIP</a></div><div class="ttdef"><b>Definition:</b> <a href="rdiff_8c_source.html#l00084">rdiff.c:84</a></div></div>
<div class="ttc" id="rdiff_8c_html_a9ae205d5a1d8a22f7369d19d57caa3c2"><div class="ttname"><a href="rdiff_8c.html#a9ae205d5a1d8a22f7369d19d57caa3c2">rs_roll_paranoia</a></div><div class="ttdeci">int rs_roll_paranoia</div><div class="ttdef"><b>Definition:</b> <a href="delta_8c_source.html#l00122">delta.c:122</a></div></div>
<div class="ttc" id="buf_8c_html_ade12a7fac722a79cf4c396cd2f7db6ff"><div class="ttname"><a href="buf_8c.html#ade12a7fac722a79cf4c396cd2f7db6ff">rs_outbuflen</a></div><div class="ttdeci">int rs_outbuflen</div><div class="ttdef"><b>Definition:</b> <a href="buf_8c_source.html#l00065">buf.c:65</a></div></div>
<div class="ttc" id="popt_8h_html_a7759fe17e59c7fb08d33984d4683e4c0"><div class="ttname"><a href="popt_8h.html#a7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a></div><div class="ttdeci">#define POPT_ARG_NONE</div><div class="ttdef"><b>Definition:</b> <a href="popt_8h_source.html#l00016">popt.h:16</a></div></div>
<div class="ttc" id="popt_8h_html_a6b2e43ed233939be1eab7e9afd66db58"><div class="ttname"><a href="popt_8h.html#a6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a></div><div class="ttdeci">#define POPT_ARG_INT</div><div class="ttdef"><b>Definition:</b> <a href="popt_8h_source.html#l00018">popt.h:18</a></div></div>
<div class="ttc" id="buf_8c_html_a13d30eb003d6b9d3311435279879dd32"><div class="ttname"><a href="buf_8c.html#a13d30eb003d6b9d3311435279879dd32">rs_inbuflen</a></div><div class="ttdeci">int rs_inbuflen</div><div class="ttdef"><b>Definition:</b> <a href="buf_8c_source.html#l00065">buf.c:65</a></div></div>
<div class="ttc" id="rdiff_8c_html_adf764cbdea00d65edcd07bb9953ad2b7ae364cc42337e882efe36076e260e422d"><div class="ttname"><a href="rdiff_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae364cc42337e882efe36076e260e422d">OPT_BZIP2</a></div><div class="ttdef"><b>Definition:</b> <a href="rdiff_8c_source.html#l00084">rdiff.c:84</a></div></div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="rdiff_8c_source.html#l00089">89</a> of file <a class="el" href="rdiff_8c_source.html">rdiff.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ae205d5a1d8a22f7369d19d57caa3c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rs_roll_paranoia</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>2002-06-26: Donovan Baarda</p>
<p>The following is based entirely on pysync. It is much cleaner than the previous incarnation of this code. It is slightly complicated because in this case the output can block, so the main delta loop needs to stop when this happens.</p>
<p>In pysync a 'last' attribute is used to hold the last miss or match for extending if possible. In this code, basis_len and scoop_pos are used instead of 'last'. When basis_len &gt; 0, last is a match. When basis_len = 0 and scoop_pos is &gt; 0, last is a miss. When both are 0, last is None (ie, nothing).</p>
<p>Pysync is also slightly different in that a 'flush' method is available to force output of accumulated data. This 'flush' is use to finalise delta calculation. In librsync input is terminated with an eof flag on the input stream. I have structured this code similar to pysync with a seperate flush function that is used when eof is reached. This allows for a flush style API if one is ever needed. Note that flush in pysync can be used for more than just terminating delta calculation, so a flush based API can in some ways be more flexible...</p>
<p>The input data is first scanned, then processed. Scanning identifies input data as misses or matches, and emits the instruction stream. Processing the data consumes it off the input scoop and outputs the processed miss data into the tube.</p>
<p>The scoop contains all data yet to be processed. The scoop_pos is an index into the scoop that indicates the point scanned to. As data is scanned, scoop_pos is incremented. As data is processed, it is removed from the scoop and scoop_pos adjusted. Everything gets complicated because the tube can block. When the tube is blocked, no data can be processed. </p>

<p>Definition at line <a class="el" href="delta_8c_source.html#l00122">122</a> of file <a class="el" href="delta_8c_source.html">delta.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
