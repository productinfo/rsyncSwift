\hypertarget{stream_8h}{}\section{/\+Users/\+Zheng/\+Desktop/librsync-\/0.9.7/stream.h File Reference}
\label{stream_8h}\index{/\+Users/\+Zheng/\+Desktop/librsync-\/0.\+9.\+7/stream.\+h@{/\+Users/\+Zheng/\+Desktop/librsync-\/0.\+9.\+7/stream.\+h}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{stream_8h_a6472f0f4fd81a841e737f6011f4cddb5}{rs\+\_\+buffers\+\_\+is\+\_\+empty} (\hyperlink{librsync_8h_abf9f543dbfe5c1e60c8ed1c93d087767}{rs\+\_\+buffers\+\_\+t} $\ast$stream)
\item 
int \hyperlink{stream_8h_abbb0798bc3ed210008ab8fb7ea386b15}{rs\+\_\+buffers\+\_\+copy} (\hyperlink{librsync_8h_abf9f543dbfe5c1e60c8ed1c93d087767}{rs\+\_\+buffers\+\_\+t} $\ast$stream, int len)
\begin{DoxyCompactList}\small\item\em Copy up to {\ttfamily max\+\_\+len} bytes from input of {\bfseries stream} to its output. \end{DoxyCompactList}\item 
int \hyperlink{stream_8h_a30833899f5f55b2a325aeca4437a1e51}{rs\+\_\+tube\+\_\+catchup} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$)
\item 
void \hyperlink{stream_8h_a15b03a73c5c997a5d5d9da3750afff3b}{rs\+\_\+tube\+\_\+write} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, void const $\ast$buf, size\+\_\+t len)
\item 
void \hyperlink{stream_8h_a1bfd11ae022f238f934aa2245d9b51d2}{rs\+\_\+tube\+\_\+copy} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, int len)
\item 
int \hyperlink{stream_8h_a301ccfd14d133eaff562c023ef36a3b7}{rs\+\_\+tube\+\_\+is\+\_\+idle} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} const $\ast$)
\item 
void \hyperlink{stream_8h_a4ff002b737707c992bfc68a1e33752a6}{rs\+\_\+check\+\_\+tube} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$)
\item 
void \hyperlink{stream_8h_a01caac1ff536e759aa3d0d884c866799}{rs\+\_\+buffers\+\_\+check\+\_\+exit} (\hyperlink{librsync_8h_abf9f543dbfe5c1e60c8ed1c93d087767}{rs\+\_\+buffers\+\_\+t} const $\ast$)
\item 
void \hyperlink{stream_8h_a9561bb8d309fb1993a8940a5534392c8}{rs\+\_\+scoop\+\_\+advance} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, size\+\_\+t len)
\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{stream_8h_af9015fb1e1cbb3faa8a2a958fbf30f1c}{rs\+\_\+scoop\+\_\+readahead} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, size\+\_\+t len, void $\ast$$\ast$ptr)
\begin{DoxyCompactList}\small\item\em Read from scoop without advancing. \end{DoxyCompactList}\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{stream_8h_a493aa12dc4bd3f98598c2e91feaed7ba}{rs\+\_\+scoop\+\_\+read} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, size\+\_\+t len, void $\ast$$\ast$ptr)
\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{stream_8h_a922564c4843614ffd087ec25382944f9}{rs\+\_\+scoop\+\_\+read\+\_\+rest} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$, size\+\_\+t $\ast$len, void $\ast$$\ast$ptr)
\item 
size\+\_\+t \hyperlink{stream_8h_a26f0ff863d2c2081d79985ff7e35da34}{rs\+\_\+scoop\+\_\+total\+\_\+avail} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job)
\item 
void \hyperlink{stream_8h_aa8d4039d1b2ab513e3682925eb66d2cd}{rs\+\_\+scoop\+\_\+input} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t len)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{stream_8h_a01caac1ff536e759aa3d0d884c866799}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+buffers\+\_\+check\+\_\+exit@{rs\+\_\+buffers\+\_\+check\+\_\+exit}}
\index{rs\+\_\+buffers\+\_\+check\+\_\+exit@{rs\+\_\+buffers\+\_\+check\+\_\+exit}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+buffers\+\_\+check\+\_\+exit(rs\+\_\+buffers\+\_\+t const $\ast$)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+buffers\+\_\+check\+\_\+exit (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+buffers\+\_\+t} const $\ast$}]{stream}
\end{DoxyParamCaption}
)}\label{stream_8h_a01caac1ff536e759aa3d0d884c866799}
Whenever a stream processing function exits, it should have done so because it has either consumed all the input or has filled the output buffer. This function checks that simple postcondition. 

Definition at line 152 of file stream.\+c.

\hypertarget{stream_8h_abbb0798bc3ed210008ab8fb7ea386b15}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+buffers\+\_\+copy@{rs\+\_\+buffers\+\_\+copy}}
\index{rs\+\_\+buffers\+\_\+copy@{rs\+\_\+buffers\+\_\+copy}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+buffers\+\_\+copy(rs\+\_\+buffers\+\_\+t $\ast$stream, int len)}]{\setlength{\rightskip}{0pt plus 5cm}int rs\+\_\+buffers\+\_\+copy (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+buffers\+\_\+t} $\ast$}]{stream, }
\item[{int}]{max\+\_\+len}
\end{DoxyParamCaption}
)}\label{stream_8h_abbb0798bc3ed210008ab8fb7ea386b15}


Copy up to {\ttfamily max\+\_\+len} bytes from input of {\bfseries stream} to its output. 

Return the number of bytes actually copied, which may be less than L\+E\+N if there is not enough space in one or the other stream.

This always does the copy immediately. Most functions should call \hyperlink{stream_8h_a1bfd11ae022f238f934aa2245d9b51d2}{rs\+\_\+tube\+\_\+copy()} to cause the copy to happen gradually as space becomes available. 

Definition at line 112 of file stream.\+c.

\hypertarget{stream_8h_a6472f0f4fd81a841e737f6011f4cddb5}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+buffers\+\_\+is\+\_\+empty@{rs\+\_\+buffers\+\_\+is\+\_\+empty}}
\index{rs\+\_\+buffers\+\_\+is\+\_\+empty@{rs\+\_\+buffers\+\_\+is\+\_\+empty}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+buffers\+\_\+is\+\_\+empty(rs\+\_\+buffers\+\_\+t $\ast$stream)}]{\setlength{\rightskip}{0pt plus 5cm}int rs\+\_\+buffers\+\_\+is\+\_\+empty (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+buffers\+\_\+t} $\ast$}]{stream}
\end{DoxyParamCaption}
)}\label{stream_8h_a6472f0f4fd81a841e737f6011f4cddb5}
\hypertarget{stream_8h_a4ff002b737707c992bfc68a1e33752a6}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+check\+\_\+tube@{rs\+\_\+check\+\_\+tube}}
\index{rs\+\_\+check\+\_\+tube@{rs\+\_\+check\+\_\+tube}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+check\+\_\+tube(rs\+\_\+job\+\_\+t $\ast$)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+check\+\_\+tube (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{}
\end{DoxyParamCaption}
)}\label{stream_8h_a4ff002b737707c992bfc68a1e33752a6}
\hypertarget{stream_8h_a9561bb8d309fb1993a8940a5534392c8}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+advance@{rs\+\_\+scoop\+\_\+advance}}
\index{rs\+\_\+scoop\+\_\+advance@{rs\+\_\+scoop\+\_\+advance}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+advance(rs\+\_\+job\+\_\+t $\ast$, size\+\_\+t len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+scoop\+\_\+advance (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len}
\end{DoxyParamCaption}
)}\label{stream_8h_a9561bb8d309fb1993a8940a5534392c8}
Advance the input cursor forward {\ttfamily len} bytes. This is used after doing readahead, when you decide you want to keep it. {\ttfamily len} must be no more than the amount of available data, so you can\textquotesingle{}t cheat.

So when creating a delta, we require one block of readahead. But after examining that block, we might decide to advance over all of it (if there is a match), or just one byte (if not). 

Definition at line 130 of file scoop.\+c.

\hypertarget{stream_8h_aa8d4039d1b2ab513e3682925eb66d2cd}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+input@{rs\+\_\+scoop\+\_\+input}}
\index{rs\+\_\+scoop\+\_\+input@{rs\+\_\+scoop\+\_\+input}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+input(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+scoop\+\_\+input (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len}
\end{DoxyParamCaption}
)}\label{stream_8h_aa8d4039d1b2ab513e3682925eb66d2cd}
Try to accept a from the input buffer to get L\+E\+N bytes in the scoop. 

Definition at line 79 of file scoop.\+c.

\hypertarget{stream_8h_a493aa12dc4bd3f98598c2e91feaed7ba}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+read@{rs\+\_\+scoop\+\_\+read}}
\index{rs\+\_\+scoop\+\_\+read@{rs\+\_\+scoop\+\_\+read}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+read(rs\+\_\+job\+\_\+t $\ast$, size\+\_\+t len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{stream_8h_a493aa12dc4bd3f98598c2e91feaed7ba}
Read L\+E\+N bytes if possible, and remove them from the input scoop. If there\textquotesingle{}s not enough data yet, return R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D.


\begin{DoxyParams}{Parameters}
{\em ptr} & will be updated to point to a read-\/only buffer holding the data, if enough is available.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
R\+S\+\_\+\+D\+O\+N\+E if all the data was available, R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D if it\textquotesingle{}s not there. 
\end{DoxyReturn}


Definition at line 230 of file scoop.\+c.

\hypertarget{stream_8h_a922564c4843614ffd087ec25382944f9}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+read\+\_\+rest@{rs\+\_\+scoop\+\_\+read\+\_\+rest}}
\index{rs\+\_\+scoop\+\_\+read\+\_\+rest@{rs\+\_\+scoop\+\_\+read\+\_\+rest}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+read\+\_\+rest(rs\+\_\+job\+\_\+t $\ast$, size\+\_\+t $\ast$len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+read\+\_\+rest (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{, }
\item[{size\+\_\+t $\ast$}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{stream_8h_a922564c4843614ffd087ec25382944f9}


Definition at line 247 of file scoop.\+c.

\hypertarget{stream_8h_af9015fb1e1cbb3faa8a2a958fbf30f1c}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+readahead@{rs\+\_\+scoop\+\_\+readahead}}
\index{rs\+\_\+scoop\+\_\+readahead@{rs\+\_\+scoop\+\_\+readahead}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+readahead(rs\+\_\+job\+\_\+t $\ast$, size\+\_\+t len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+readahead (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{stream_8h_af9015fb1e1cbb3faa8a2a958fbf30f1c}


Read from scoop without advancing. 

Ask for L\+E\+N bytes of input from the stream. If that much data is available, then return a pointer to it in P\+T\+R, advance the stream input pointer over the data, and return R\+S\+\_\+\+D\+O\+N\+E. If there\textquotesingle{}s not enough data, then accept whatever is there into a buffer, advance over it, and return R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D.

The data is not actually removed from the input, so this function lets you do readahead. If you want to keep any of the data, you should also call \hyperlink{scoop_8c_aad3e63ccd707266363d6feeca754a370}{rs\+\_\+scoop\+\_\+advance()} to skip over it. 

Definition at line 166 of file scoop.\+c.

\hypertarget{stream_8h_a26f0ff863d2c2081d79985ff7e35da34}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+scoop\+\_\+total\+\_\+avail@{rs\+\_\+scoop\+\_\+total\+\_\+avail}}
\index{rs\+\_\+scoop\+\_\+total\+\_\+avail@{rs\+\_\+scoop\+\_\+total\+\_\+avail}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+scoop\+\_\+total\+\_\+avail(rs\+\_\+job\+\_\+t $\ast$job)}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t rs\+\_\+scoop\+\_\+total\+\_\+avail (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job}
\end{DoxyParamCaption}
)}\label{stream_8h_a26f0ff863d2c2081d79985ff7e35da34}
Return the total number of bytes available including the scoop and input buffer. 

Definition at line 262 of file scoop.\+c.

\hypertarget{stream_8h_a30833899f5f55b2a325aeca4437a1e51}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+tube\+\_\+catchup@{rs\+\_\+tube\+\_\+catchup}}
\index{rs\+\_\+tube\+\_\+catchup@{rs\+\_\+tube\+\_\+catchup}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+tube\+\_\+catchup(rs\+\_\+job\+\_\+t $\ast$)}]{\setlength{\rightskip}{0pt plus 5cm}int rs\+\_\+tube\+\_\+catchup (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{}
\end{DoxyParamCaption}
)}\label{stream_8h_a30833899f5f55b2a325aeca4437a1e51}


Definition at line 184 of file tube.\+c.

\hypertarget{stream_8h_a1bfd11ae022f238f934aa2245d9b51d2}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+tube\+\_\+copy@{rs\+\_\+tube\+\_\+copy}}
\index{rs\+\_\+tube\+\_\+copy@{rs\+\_\+tube\+\_\+copy}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+tube\+\_\+copy(rs\+\_\+job\+\_\+t $\ast$, int len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+tube\+\_\+copy (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}\label{stream_8h_a1bfd11ae022f238f934aa2245d9b51d2}
Queue up a request to copy through {\ttfamily len} bytes from the input to the output of the stream.

The data is copied from the scoop (if there is anything there) or from the input, on the next call to \hyperlink{tube_8c_a15809106e8f91386fb19f3934f73b993}{rs\+\_\+tube\+\_\+write()}.

We can only accept this request if there is no copy command already pending. 

Definition at line 235 of file tube.\+c.

\hypertarget{stream_8h_a301ccfd14d133eaff562c023ef36a3b7}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+tube\+\_\+is\+\_\+idle@{rs\+\_\+tube\+\_\+is\+\_\+idle}}
\index{rs\+\_\+tube\+\_\+is\+\_\+idle@{rs\+\_\+tube\+\_\+is\+\_\+idle}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+tube\+\_\+is\+\_\+idle(rs\+\_\+job\+\_\+t const $\ast$)}]{\setlength{\rightskip}{0pt plus 5cm}int rs\+\_\+tube\+\_\+is\+\_\+idle (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} const $\ast$}]{}
\end{DoxyParamCaption}
)}\label{stream_8h_a301ccfd14d133eaff562c023ef36a3b7}


Definition at line 215 of file tube.\+c.

\hypertarget{stream_8h_a15b03a73c5c997a5d5d9da3750afff3b}{}\index{stream.\+h@{stream.\+h}!rs\+\_\+tube\+\_\+write@{rs\+\_\+tube\+\_\+write}}
\index{rs\+\_\+tube\+\_\+write@{rs\+\_\+tube\+\_\+write}!stream.\+h@{stream.\+h}}
\subsubsection[{rs\+\_\+tube\+\_\+write(rs\+\_\+job\+\_\+t $\ast$, void const $\ast$buf, size\+\_\+t len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+tube\+\_\+write (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{, }
\item[{void const $\ast$}]{buf, }
\item[{size\+\_\+t}]{len}
\end{DoxyParamCaption}
)}\label{stream_8h_a15b03a73c5c997a5d5d9da3750afff3b}
