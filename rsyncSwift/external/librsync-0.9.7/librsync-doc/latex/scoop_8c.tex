\hypertarget{scoop_8c}{}\section{/\+Users/\+Zheng/\+Desktop/librsync-\/0.9.7/scoop.c File Reference}
\label{scoop_8c}\index{/\+Users/\+Zheng/\+Desktop/librsync-\/0.\+9.\+7/scoop.\+c@{/\+Users/\+Zheng/\+Desktop/librsync-\/0.\+9.\+7/scoop.\+c}}
{\ttfamily \#include $<$config.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include \char`\"{}librsync.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}job.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}stream.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}trace.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{scoop_8c_aa8d4039d1b2ab513e3682925eb66d2cd}{rs\+\_\+scoop\+\_\+input} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t len)
\item 
void \hyperlink{scoop_8c_aad3e63ccd707266363d6feeca754a370}{rs\+\_\+scoop\+\_\+advance} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t len)
\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{scoop_8c_a026b9505478d48f4b9b05fea46c166e1}{rs\+\_\+scoop\+\_\+readahead} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t len, void $\ast$$\ast$ptr)
\begin{DoxyCompactList}\small\item\em Read from scoop without advancing. \end{DoxyCompactList}\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{scoop_8c_a9eb894edc12cd2972a1eb020bdc80725}{rs\+\_\+scoop\+\_\+read} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t len, void $\ast$$\ast$ptr)
\item 
\hyperlink{librsync_8h_a7feb858ceba3b8f3cf048d49be108253}{rs\+\_\+result} \hyperlink{scoop_8c_af9c1b8a80bbed23d9409559fa101496b}{rs\+\_\+scoop\+\_\+read\+\_\+rest} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job, size\+\_\+t $\ast$len, void $\ast$$\ast$ptr)
\item 
size\+\_\+t \hyperlink{scoop_8c_a26f0ff863d2c2081d79985ff7e35da34}{rs\+\_\+scoop\+\_\+total\+\_\+avail} (\hyperlink{librsync_8h_a99e68494fe0ac6b84f4ecfb646690c35}{rs\+\_\+job\+\_\+t} $\ast$job)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{scoop_8c_aad3e63ccd707266363d6feeca754a370}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+advance@{rs\+\_\+scoop\+\_\+advance}}
\index{rs\+\_\+scoop\+\_\+advance@{rs\+\_\+scoop\+\_\+advance}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+advance(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+scoop\+\_\+advance (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len}
\end{DoxyParamCaption}
)}\label{scoop_8c_aad3e63ccd707266363d6feeca754a370}
Advance the input cursor forward {\ttfamily len} bytes. This is used after doing readahead, when you decide you want to keep it. {\ttfamily len} must be no more than the amount of available data, so you can\textquotesingle{}t cheat.

So when creating a delta, we require one block of readahead. But after examining that block, we might decide to advance over all of it (if there is a match), or just one byte (if not). 

Definition at line 130 of file scoop.\+c.

\hypertarget{scoop_8c_aa8d4039d1b2ab513e3682925eb66d2cd}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+input@{rs\+\_\+scoop\+\_\+input}}
\index{rs\+\_\+scoop\+\_\+input@{rs\+\_\+scoop\+\_\+input}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+input(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t len)}]{\setlength{\rightskip}{0pt plus 5cm}void rs\+\_\+scoop\+\_\+input (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len}
\end{DoxyParamCaption}
)}\label{scoop_8c_aa8d4039d1b2ab513e3682925eb66d2cd}
Try to accept a from the input buffer to get L\+E\+N bytes in the scoop. 

Definition at line 79 of file scoop.\+c.

\hypertarget{scoop_8c_a9eb894edc12cd2972a1eb020bdc80725}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+read@{rs\+\_\+scoop\+\_\+read}}
\index{rs\+\_\+scoop\+\_\+read@{rs\+\_\+scoop\+\_\+read}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+read(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{scoop_8c_a9eb894edc12cd2972a1eb020bdc80725}
Read L\+E\+N bytes if possible, and remove them from the input scoop. If there\textquotesingle{}s not enough data yet, return R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D.


\begin{DoxyParams}{Parameters}
{\em ptr} & will be updated to point to a read-\/only buffer holding the data, if enough is available.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
R\+S\+\_\+\+D\+O\+N\+E if all the data was available, R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D if it\textquotesingle{}s not there. 
\end{DoxyReturn}


Definition at line 230 of file scoop.\+c.

\hypertarget{scoop_8c_af9c1b8a80bbed23d9409559fa101496b}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+read\+\_\+rest@{rs\+\_\+scoop\+\_\+read\+\_\+rest}}
\index{rs\+\_\+scoop\+\_\+read\+\_\+rest@{rs\+\_\+scoop\+\_\+read\+\_\+rest}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+read\+\_\+rest(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t $\ast$len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+read\+\_\+rest (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t $\ast$}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{scoop_8c_af9c1b8a80bbed23d9409559fa101496b}


Definition at line 247 of file scoop.\+c.

\hypertarget{scoop_8c_a026b9505478d48f4b9b05fea46c166e1}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+readahead@{rs\+\_\+scoop\+\_\+readahead}}
\index{rs\+\_\+scoop\+\_\+readahead@{rs\+\_\+scoop\+\_\+readahead}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+readahead(rs\+\_\+job\+\_\+t $\ast$job, size\+\_\+t len, void $\ast$$\ast$ptr)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rs\+\_\+result} rs\+\_\+scoop\+\_\+readahead (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job, }
\item[{size\+\_\+t}]{len, }
\item[{void $\ast$$\ast$}]{ptr}
\end{DoxyParamCaption}
)}\label{scoop_8c_a026b9505478d48f4b9b05fea46c166e1}


Read from scoop without advancing. 

Ask for L\+E\+N bytes of input from the stream. If that much data is available, then return a pointer to it in P\+T\+R, advance the stream input pointer over the data, and return R\+S\+\_\+\+D\+O\+N\+E. If there\textquotesingle{}s not enough data, then accept whatever is there into a buffer, advance over it, and return R\+S\+\_\+\+B\+L\+O\+C\+K\+E\+D.

The data is not actually removed from the input, so this function lets you do readahead. If you want to keep any of the data, you should also call \hyperlink{scoop_8c_aad3e63ccd707266363d6feeca754a370}{rs\+\_\+scoop\+\_\+advance()} to skip over it. 

Definition at line 166 of file scoop.\+c.

\hypertarget{scoop_8c_a26f0ff863d2c2081d79985ff7e35da34}{}\index{scoop.\+c@{scoop.\+c}!rs\+\_\+scoop\+\_\+total\+\_\+avail@{rs\+\_\+scoop\+\_\+total\+\_\+avail}}
\index{rs\+\_\+scoop\+\_\+total\+\_\+avail@{rs\+\_\+scoop\+\_\+total\+\_\+avail}!scoop.\+c@{scoop.\+c}}
\subsubsection[{rs\+\_\+scoop\+\_\+total\+\_\+avail(rs\+\_\+job\+\_\+t $\ast$job)}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t rs\+\_\+scoop\+\_\+total\+\_\+avail (
\begin{DoxyParamCaption}
\item[{{\bf rs\+\_\+job\+\_\+t} $\ast$}]{job}
\end{DoxyParamCaption}
)}\label{scoop_8c_a26f0ff863d2c2081d79985ff7e35da34}
Return the total number of bytes available including the scoop and input buffer. 

Definition at line 262 of file scoop.\+c.

